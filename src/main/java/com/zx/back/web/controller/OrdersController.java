package com.zx.back.web.controller;import com.zx.back.model.Flight;import com.zx.back.model.Orders;import com.zx.back.model.User;import com.zx.back.service.IflightService;import com.zx.back.service.IordersService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import javax.servlet.http.HttpServletResponse;import javax.servlet.http.HttpSession;import java.text.SimpleDateFormat;import java.util.Date;import java.util.List;@Controller@RequestMapping("orders")public class OrdersController {    @Autowired    private IordersService iordersService;    @Autowired    private IflightService iflightService;    //查询订单    @RequestMapping("order")    public String order(Model model, HttpSession session) {        User user1 = (User) session.getAttribute("user");        //System.out.println(user1);        List<Orders> orders = iordersService.findorders(user1.getUname());        model.addAttribute("orders",orders);        return "order";    }    //新增订单    @RequestMapping("saveOrder")    public String saveOrder(String fid, HttpSession session, HttpServletResponse response) throws Exception {        //当前时间格式化        Date d = new Date();        SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");        String date = sdf.format(d);        Flight flight = iflightService.selectById(fid);//      System.out.println(flight);        if (flight.getseatsum()<=0){            response.setContentType("text/html;charset=utf-8");            response.getWriter().print("<script>alert('票已售完');window.location.href='http://localhost:8080/views/flylist.jsp'</script>");            return null;        }        //写入orders表        User user = (User) session.getAttribute("user");        iordersService.saveOrder(date, user.getUid(), fid);        //更新余座        int seat = flight.getseatsum()-1;        iflightService.updateseats(fid, seat);        return "forward:order.do";    }    //退订删除订单    @RequestMapping("deleteOrder")    public String deleteOrder(Integer oid, String fid){        //System.out.println(fid);        iordersService.deleteOrder(oid);        //更新余座        Flight flight = iflightService.selectById(fid);        int seat = flight.getseatsum()+1;        iflightService.updateseats(fid, seat);        return "forward:order.do";    }}